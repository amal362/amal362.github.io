import{a as w}from"./index-DlLG_XU7.js";const C=async e=>new Promise((t,n)=>{const o=new FileReader;o.onload=()=>{const s=o.result,a=s.substr(s.indexOf(",")+1);t(a)},o.onerror=s=>n(s),o.readAsDataURL(e)}),b=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),k=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),j=(e,t,n={})=>{const o=b(e),s=b(t),a="; expires=".concat((n.expires||"").replace("expires=","")),c=(n.path||"/").replace("path=","");document.cookie="".concat(o,"=").concat(s||"").concat(a,"; path=").concat(c)},y=()=>{const e=[],t={};if(!document.cookie)return e;const n=document.cookie.split(";")||[];for(const s of n){let[a,c]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=k(a).trim(),c=k(c).trim(),t[a]=c}const o=Object.entries(t);for(const[s,a]of o)e.push({key:s,value:a});return e},x=e=>{const t=y();for(const n of t)if(n.key===e)return n;return{key:e,value:""}},$=e=>{document.cookie="".concat(e,"=; Max-Age=0")},m=()=>{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires=".concat(new Date().toUTCString(),";path=/"))},E=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(s=>s.toLocaleLowerCase()).reduce((s,a,c)=>(s[a]=e[t[c]],s),{})},A=(e,t=!0)=>e?Object.entries(e).reduce((o,s)=>{const[a,c]=s;let r,i;return Array.isArray(c)?(i="",c.forEach(d=>{r=t?encodeURIComponent(d):d,i+="".concat(a,"=").concat(r,"&")}),i.slice(0,-1)):(r=t?encodeURIComponent(c):c,i="".concat(a,"=").concat(r)),"".concat(o,"&").concat(i)},"").substr(1):null,g=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),s=E(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(s.includes("application/x-www-form-urlencoded")){const a=new URLSearchParams;for(const[c,r]of Object.entries(e.data||{}))a.set(c,r);n.body=a.toString()}else if(s.includes("multipart/form-data")){const a=new FormData;if(e.data instanceof FormData)e.data.forEach((r,i)=>{a.append(i,r)});else for(let r of Object.keys(e.data))a.append(r,e.data[r]);n.body=a;const c=new Headers(n.headers);c.delete("content-type"),n.headers=c}else(s.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n},l=async e=>{const t=g(e,e.webFetchExtra),n=A(e.params,e.shouldEncodeUrlParams),o=n?"".concat(e.url,"?").concat(n):e.url,s=await fetch(o,t),a=s.headers.get("content-type")||"";let{responseType:c="text"}=s.ok?e:{};a.includes("application/json")&&(c="json");let r;switch(c){case"arraybuffer":case"blob":const d=await s.blob();r=await C(d);break;case"json":r=await s.json();break;case"document":case"text":default:r=await s.text()}const i={};return s.headers.forEach((d,h)=>{i[h]=d}),{data:r,headers:i,status:s.status,url:s.url}},P=async e=>l(Object.assign(Object.assign({},e),{method:"GET"})),T=async e=>l(Object.assign(Object.assign({},e),{method:"POST"})),U=async e=>l(Object.assign(Object.assign({},e),{method:"PUT"})),I=async e=>l(Object.assign(Object.assign({},e),{method:"PATCH"})),R=async e=>l(Object.assign(Object.assign({},e),{method:"DELETE"}));class F extends w{constructor(){super(),this.request=async t=>l(t),this.get=async t=>P(t),this.post=async t=>T(t),this.put=async t=>U(t),this.patch=async t=>I(t),this.del=async t=>R(t),this.getCookiesMap=async t=>{const n=y(),o={};for(const s of n)o[s.key]=s.value;return o},this.getCookies=async t=>({cookies:y()}),this.setCookie=async t=>{const{key:n,value:o,expires:s="",path:a=""}=t;j(n,o,{expires:s,path:a})},this.getCookie=async t=>x(t.key),this.deleteCookie=async t=>$(t.key),this.clearCookies=async t=>m(),this.clearAllCookies=async()=>m(),this.uploadFile=async t=>{const n=new FormData;n.append(t.name,t.blob||"undefined");const o=Object.assign(Object.assign({},t),{body:n,method:"POST"});return this.post(o)},this.downloadFile=async t=>{const n=g(t,t.webFetchExtra),o=await fetch(t.url,n);let s;if(!(t!=null&&t.progress))s=await o.blob();else if(!(o!=null&&o.body))s=new Blob;else{const a=o.body.getReader();let c=0,r=[];const i=o.headers.get("content-type"),d=parseInt(o.headers.get("content-length")||"0",10);for(;;){const{done:u,value:p}=await a.read();if(u)break;r.push(p),c+=(p==null?void 0:p.length)||0;const O={type:"DOWNLOAD",url:t.url,bytes:c,contentLength:d};this.notifyListeners("progress",O)}let h=new Uint8Array(c),f=0;for(const u of r)typeof u>"u"||(h.set(u,f),f+=u.length);s=new Blob([h.buffer],{type:i||void 0})}return{blob:s}}}}export{F as HttpWeb};
